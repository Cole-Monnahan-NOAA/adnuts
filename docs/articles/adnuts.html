<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>No-U-turn sampling for TMB and ADMB models • adnuts</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="No-U-turn sampling for TMB and ADMB models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">adnuts</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/adnuts.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/NUTS-for-ADMB-models.html">NUTS for ADMB models</a></li>
    <li><a class="dropdown-item" href="../articles/SNUTS-for-TMB-models.html">Sparse NUTS for TMB models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Cole-Monnahan-NOAA/adnuts/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>No-U-turn sampling for TMB and ADMB models</h1>
                        <h4 data-toc-skip class="author">Cole C.
Monnahan</h4>
            
            <h4 data-toc-skip class="date">2025-08-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Cole-Monnahan-NOAA/adnuts/blob/HEAD/vignettes/adnuts.Rmd" class="external-link"><code>vignettes/adnuts.Rmd</code></a></small>
      <div class="d-none name"><code>adnuts.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p><code>adnuts</code> (pronounced A-D NUTS like A-D MB) provides a
wrapper for performing Bayesian analyses using the no-U-turn (NUTS)
algorithm <span class="citation">(Hoffman and Gelman 2014)</span> for
TMB <span class="citation">(Kristensen et al. 2016)</span> and ADMB
<span class="citation">(Fournier et al. 2012)</span> models.</p>
<p>For TMB models the NUTS algorithm is in the Stan software <span class="citation">(Carpenter et al. 2017)</span> and linked through the
<a href="https://github.com/andrjohns/StanEstimators" class="external-link">StanEstimators</a>
R package. <code>adnuts</code> implements the sparse NUTS (SNUTS)
algorithm of <span class="citation">(Monnahan et al. in prep)</span> by
decorrelating and descaling the posterior distribution prior to passing
to Stan. For models with high correlations and sparse precision
matrices, SNUTS can substantially improve sampling efficiency.
Importantly, it works for TMB and RTMB models, and can be run on models
from existing packages.</p>
<p>Basic usage for a TMB or RTMB object <code>obj</code> is shown as
follows, with a more in depth article on the website.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_snuts.html">sample_snuts</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">fit</span>, order<span class="op">=</span><span class="st">'slow'</span><span class="op">)</span></span>
<span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/launch_shinytmb.html">launch_shinytmb</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p>ADMB models contain the algorithm code internally, but this package
provides the user a convenient environment to run and diagnose Markov
chains, and make inference. Development for ADMB models is frozen but
should maintain backwards compatibility in the near future. This package
aims to give ADMB models similar functionality to the software Stan and
<code>rstan</code> in particular <span class="citation">(Carpenter et
al. 2017; Stan Development Team 2017)</span>.</p>
<p>Assuming a valid ADMB model located in directory <code>path</code>
has been built and optimized successfully, then</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wrappers.html">sample_nuts</a></span><span class="op">(</span>model<span class="op">=</span><span class="st">'simple'</span>, path<span class="op">=</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">fit</span>, order<span class="op">=</span><span class="st">'slow'</span><span class="op">)</span></span>
<span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/launch_shinyadmb.html">launch_shinyadmb</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="history">History<a class="anchor" aria-label="anchor" href="#history"></a>
</h2>
<p>The package has undergone several shifts in focus. Initially, it was
developed to provide a NUTS implementation in R for models where the
log-density and log-density gradient could be written as R functions
(e.g., TMB). However, the <code>tmbstan</code> package was developed and
became the preferred option for TMB users, so the focus switched to ADMB
models and TMB functionality was de-emphasized. In 2025, with the
development of SNUTS, the primary focus of <code>adnuts</code> was
shifted back to TMB models via the SNUTS approach.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-carpenter2017" class="csl-entry">
Carpenter, B., A. Gelman, M. D. Hoffman, D. Lee, B. Goodrich, M.
Betancourt, A. Riddell, J. Q. Guo, P. Li, and A. Riddell. 2017.
<span>“Stan: A Probabilistic Programming Language.”</span> <em>Journal
of Statistical Software</em> 76 (1): 1–29.
</div>
<div id="ref-fournier2012" class="csl-entry">
Fournier, D. A., H. J. Skaug, J. Ancheta, J. Ianelli, A. Magnusson, M.
N. Maunder, A. Nielsen, and J. Sibert. 2012. <span>“AD Model Builder:
Using Automatic Differentiation for Statistical Inference of Highly
Parameterized Complex Nonlinear Models.”</span> <em>Optimization Methods
&amp; Software</em> 27 (2): 233–49.
</div>
<div id="ref-hoffman2014" class="csl-entry">
Hoffman, M. D., and A. Gelman. 2014. <span>“The No-u-Turn Sampler:
Adaptively Setting Path Lengths in Hamiltonian Monte Carlo.”</span>
<em>Journal of Machine Learning Research</em> 15 (1): 1593–623.
</div>
<div id="ref-kristensen2016" class="csl-entry">
Kristensen, Kasper, Anders Nielsen, Casper W. Berg, Hans Skaug, and
Bradley M. Bell. 2016. <span>“TMB: Automatic Differentiation and Laplace
Approximation.”</span> <em>Journal of Statistical Software</em> 70 (5):
21.
</div>
<div id="ref-monnahan2025" class="csl-entry">
Monnahan, C. C., Thorson J. T., K. Kristensen, and B. Carpenter. in
prep. <span>“Leveraging Sparsity to Improve No-u-Turn Sampling
Efficiency for Hierarchical Bayesian Models.”</span> <em>arXiv
Preprint</em>, in prep.
</div>
<div id="ref-stan2017" class="csl-entry">
Stan Development Team. 2017. <span>“Stan Modeling Language Users Guide
and Reference Manual, Version 2.17.0.”</span>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cole Monnahan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
