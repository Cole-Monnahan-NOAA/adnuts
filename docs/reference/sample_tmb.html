<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Bayesian inference of a TMB model using the no-U-turn sampler. — sample_tmb • adnuts</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Bayesian inference of a TMB model using the no-U-turn sampler. — sample_tmb" />
<meta property="og:description" content="Draw Bayesian posterior samples from a Template Model Builder (TMB)
model using an MCMC algorithm. This function generates posterior samples
from which inference can be made. Adaptation schemes are used so
specification tuning parameters are not necessary, and parallel
execution reduces overall run time." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">adnuts</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/adnuts.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Cole-Monnahan-NOAA/adnuts/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Bayesian inference of a TMB model using the no-U-turn sampler.</h1>
    <small class="dont-index">Source: <a href='https://github.com/Cole-Monnahan-NOAA/adnuts/blob/master/R/sample_tmb_deprecated.R'><code>R/sample_tmb_deprecated.R</code></a></small>
    <div class="hidden name"><code>sample_tmb.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Draw Bayesian posterior samples from a Template Model Builder (TMB)
model using an MCMC algorithm. This function generates posterior samples
from which inference can be made. Adaptation schemes are used so
specification tuning parameters are not necessary, and parallel
execution reduces overall run time.</p>
    </div>

    <pre class="usage"><span class='fu'>sample_tmb</span><span class='op'>(</span>
  <span class='va'>obj</span>,
  iter <span class='op'>=</span> <span class='fl'>2000</span>,
  <span class='va'>init</span>,
  chains <span class='op'>=</span> <span class='fl'>3</span>,
  seeds <span class='op'>=</span> <span class='cn'>NULL</span>,
  warmup <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>floor</a></span><span class='op'>(</span><span class='va'>iter</span><span class='op'>/</span><span class='fl'>2</span><span class='op'>)</span>,
  lower <span class='op'>=</span> <span class='cn'>NULL</span>,
  upper <span class='op'>=</span> <span class='cn'>NULL</span>,
  thin <span class='op'>=</span> <span class='fl'>1</span>,
  parallel <span class='op'>=</span> <span class='cn'>FALSE</span>,
  cores <span class='op'>=</span> <span class='cn'>NULL</span>,
  path <span class='op'>=</span> <span class='cn'>NULL</span>,
  algorithm <span class='op'>=</span> <span class='st'>"NUTS"</span>,
  laplace <span class='op'>=</span> <span class='cn'>FALSE</span>,
  control <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>obj</th>
      <td><p>A TMB model object.</p></td>
    </tr>
    <tr>
      <th>iter</th>
      <td><p>The number of samples to draw.</p></td>
    </tr>
    <tr>
      <th>init</th>
      <td><p>A list of lists containing the initial parameter
vectors, one for each chain or a function. It is strongly
recommended to initialize multiple chains from dispersed
points. A of NULL signifies to use the starting values
present in the model (i.e., <code>obj$par</code>) for all chains.</p></td>
    </tr>
    <tr>
      <th>chains</th>
      <td><p>The number of chains to run.</p></td>
    </tr>
    <tr>
      <th>seeds</th>
      <td><p>A vector of seeds, one for each chain.</p></td>
    </tr>
    <tr>
      <th>warmup</th>
      <td><p>The number of warmup iterations.</p></td>
    </tr>
    <tr>
      <th>lower</th>
      <td><p>A vector of lower bounds for parameters. Allowed values are
-Inf and numeric.</p></td>
    </tr>
    <tr>
      <th>upper</th>
      <td><p>A vector of upper bounds for parameters. Allowed values are
Inf and numeric.</p></td>
    </tr>
    <tr>
      <th>thin</th>
      <td><p>The thinning rate to apply to samples. Typically
not used with NUTS.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>A deprecated argument, use cores=1 for serial
execution or cores&gt;1 for parallel (default is to parallel
with cores equal to the available-1)</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>The number of cores to use for parallel
execution. Default is number available in the system minus
1. If <code>cores=1</code>, serial execution occurs (even if
<code>chains&gt;1</code>), otherwise parallel execution via package
snowfall is used. For slow analyses it is recommended to set
<code>chains</code>&lt;=<code>cores</code> so each core needs to run only a
single chain.</p></td>
    </tr>
    <tr>
      <th>path</th>
      <td><p>Path to model executable. Defaults to working
directory. Often best to have model files in a separate
subdirectory, particularly for parallel.</p></td>
    </tr>
    <tr>
      <th>algorithm</th>
      <td><p>The algorithm to use. NUTS is the default and
recommended one, but "RWM" for the random walk Metropolis sampler and
"HMC" for the static HMC sampler are available. These last two are
deprecated but may be of use in some situations. These algorithms
require different arguments; see their help files for more
information.</p></td>
    </tr>
    <tr>
      <th>laplace</th>
      <td><p>Whether to use the Laplace approximation if some
parameters are declared as random. Default is to turn off this
functionality and integrate across all parameters with MCMC.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>A list to control the sampler. See details for
further use.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments to be passed to samplers</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list containing the samples, and properties of the sampler
  useful for diagnosing behavior and efficiency.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function implements algorithm 6 of Hoffman and Gelman (2014),
and loosely follows package <code>rstan</code>. The step size can be
  adapted or specified manually. The metric (i.e., mass matrix) can be
  unit diagonal, adapted diagonal (default and recommended), or a dense
  matrix specified by the user. Further control of algorithms can be
  specified with the <code>control</code> argument.  Elements are:</p><dl>
<dt>adapt_delta</dt><dd><p>The target acceptance rate.</p></dd>
<dt>metric</dt><dd><p>The mass metric to use. Options are: "unit" for a unit diagonal
  matrix; "diag" to estimate a diagonal matrix during warmup; a matrix
  to be used directly (in untransformed space).</p></dd>
<dt>adapt_engaged</dt><dd><p>Whether adaptation of step size and metric is turned on.</p></dd>
<dt>max_treedepth</dt><dd><p>Maximum treedepth for the NUTS algorithm.</p></dd>
<dt>stepsize</dt><dd><p>The stepsize for the NUTS algorithm. If <code>NULL</code> it
  will be adapted during warmup.</p></dd>

</dl>

    <h2 class="hasAnchor" id="warning"><a class="anchor" href="#warning"></a>Warning</h2>

    <p>This is deprecated and will cease to exist
  in future releases</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='extract_samples.html'>extract_samples</a></code> to extract samples and
  <code><a href='launch_shinytmb.html'>launch_shinytmb</a></code> to explore the results graphically which
  is a wrapper for the <code><a href='https://rdrr.io/pkg/shinystan/man/launch_shinystan.html'>launch_shinystan</a></code> function.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Cole Monnahan</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Build a fake TMB object with objective &amp; gradient functions and some</span>
<span class='co'>## other flags</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='va'>f</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>order</span><span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span><span class='op'>{</span>
  <span class='kw'>if</span><span class='op'>(</span><span class='va'>order</span> <span class='op'>!=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='co'># negative log density</span>
    <span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>dnorm</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>x</span>, mean<span class='op'>=</span><span class='fl'>0</span>, sd<span class='op'>=</span><span class='fl'>1</span>, log<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
  <span class='kw'>else</span> <span class='va'>x</span> <span class='co'># gradient of negative log density</span>
<span class='op'>}</span>
<span class='va'>init</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>2</span><span class='op'>)</span>
<span class='va'>obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>env<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>DLL<span class='op'>=</span><span class='st'>'demo'</span>, last.par.best<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fu'>init</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>, f<span class='op'>=</span><span class='va'>f</span>,
  beSilent<span class='op'>=</span><span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='cn'>NULL</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## Run NUTS for this object</span>
<span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'>sample_tmb</span><span class='op'>(</span><span class='va'>obj</span>, iter<span class='op'>=</span><span class='fl'>1000</span>, chains<span class='op'>=</span><span class='fl'>3</span>, init<span class='op'>=</span><span class='va'>init</span><span class='op'>)</span>
<span class='co'>## Check basic diagnostics</span>
<span class='va'>mon</span> <span class='op'>&lt;-</span> <span class='fu'>rstan</span><span class='fu'>::</span><span class='fu'><a href='https://mc-stan.org/rstan/reference/monitor.html'>monitor</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>$</span><span class='va'>samples</span>, print<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span>
<span class='va'>Rhat</span> <span class='op'>&lt;-</span> <span class='va'>mon</span><span class='op'>[</span>,<span class='st'>"Rhat"</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>Rhat</span><span class='op'>)</span>
<span class='va'>ess</span> <span class='op'>&lt;-</span> <span class='va'>mon</span><span class='op'>[</span>, <span class='st'>'n_eff'</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>ess</span><span class='op'>)</span>
<span class='co'>## Or do it interactively with ShinyStan</span>
<span class='fu'><a href='launch_shinytmb.html'>launch_shinytmb</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Cole Monnahan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


